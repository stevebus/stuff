
iothub_name=$1

echo 'installing azure cli extension'

# az extension add --name azure-iot -y

iothubtoken=$(az iot hub generate-sas-token -n $iothub_name | jq .sas | tr -d \")


for dev in {61..70}
do
    deviceId="device${dev}"

    data='{"deviceId":"'"$deviceId"'", "authentication":{"symmetricKey":{"primaryKey":"M4M04OgpQHC9RDfOUXwBwXvnFNWvcA/3MweXLHwhjBo=","secondaryKey":"M4M04OgpQHC9RDfOUXwBwXvnFNWvcA/3MweXLHwhjBo="}},"status":"enabled"}'
    echo $data
    curl -L -X PUT -H 'Content-Type: application/json' -H 'Content-Encoding:  utf-8' -H "Authorization: $iothubtoken" -d $data "https://$iothub_name.azure-devices.net/devices/$deviceId?api-version=2020-05-31-preview"
done

JSON_STRING=$( jq -n \
                  --arg helloarg "$iothubtoken" \
                  '{hello: $helloarg}' )

echo $JSON_STRING

echo $JSON_STRING > $AZ_SCRIPTS_OUTPUT_PATH
